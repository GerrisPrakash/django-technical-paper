# Django

## What is secret key?

The SECRET_KEY is a randomly generated string used for cryptographic signing in Django. It is crucial for:
* Session management
* CSRF protection

Never expose your SECRET_KEY in public repositories or client-side code.

## Default Django Apps
When you create a new Django project, the default apps included are:

* django.contrib.admin – Admin site

* django.contrib.auth – Authentication system

* django.contrib.contenttypes – Content type framework

* django.contrib.sessions – Session management

* django.contrib.messages – Messaging framework

* django.contrib.staticfiles – Handling static files

Additional apps can be installed or created depending on the project’s needs.

## Middleware in Django
Middleware is a framework of hooks into Django’s request/response processing. It’s a layer of components that process requests before they reach the view and responses before they reach the client.

### Types of Middleware

* Security Middleware: Handles HTTPS, clickjacking prevention, and other security features.

* Session Middleware: Enables session management for requests.

* Authentication Middleware: Associates users with requests.

* Message Middleware: Enables temporary messages storage between requests.

* Common Middleware: Handles URL normalization, trailing slashes, etc.

### Common Security Issues Addressed

* CSRF (Cross-Site Request Forgery): Prevented using CsrfViewMiddleware. Ensures POST requests come from trusted sources.

* XSS (Cross-Site Scripting): Mitigated via template auto-escaping.

* Clickjacking: Prevented using XFrameOptionsMiddleware to control iframe usage.

Other middleware can be added as required, e.g., GZipMiddleware for compression.

### WSGI (Web Server Gateway Interface)

WSGI is the interface between web servers and Python web applications. Django uses a wsgi.py file to communicate with servers like Gunicorn or uWSGI, enabling deployment in production.

# Django Models

Models define the structure of your database tables in Python code.

## on_delete=CASCADE

This is used in foreign key relationships. When a referenced object is deleted, all related objects with CASCADE are also deleted.

```
class Company(models.Model):
    owner = models.ForeignKey(User, on_delete=models.CASCADE)
```

## Fields & Validators

* Common Django model fields:

* CharField – Short text

* TextField – Long text

* IntegerField – Integer numbers

* DateTimeField – Date and time

Validators ensure data integrity, e.g., MaxLengthValidator, MinValueValidator, RegexValidator.

## Python Module vs Class

Module: A Python file (.py) containing functions, variables, and classes.

Class: Blueprint for creating objects with attributes and methods.

# Django ORM (Object-Relational Mapping)
Django ORM allows you to interact with your database using Python instead of raw SQL.

## Using ORM Queries

```
# Fetch all companies
Companies.objects.all()

# Filter by location
Companies.objects.filter(location='banglore')
```

## Turning ORM into SQL
```
qs = Companies.objects.filter(location='banglore')
print(qs.query)
```
## Aggregations
Used to compute values like sum, average, count:
```
from django.db.models import Avg
Companies.objects.all().aggregate(Avg('ratting'))

```

## Annotations
Add calculated fields to each object:

```
from django.db.models import Count
from .models import User

users = User.objects.annotate(post_count=Count('post'))

for user in users:
    print(user.username, user.company_count)


```

# Migrations in Django

Migration files are Python scripts generated by Django to reflect model changes in the database.

Why Needed: Keeps the database schema synchronized with models.

```
python manage.py makemigrations
python manage.py migrate

```

# SQL Transactions and Atomicity

* SQL Transaction: A unit of work in the database that is either fully completed or fully rolled back.

* Atomic Transactions in Django:

```
from django.db import transaction

with transaction.atomic():
    # perform multiple DB operations

```
